"use client";

import { CustomButtonIcon, Icon } from "@/components/atoms";
import { CardTemplate } from "@/components/molecules";
import { useGetUser, useNavigationOnboarding } from "@/hooks";
import { RootState } from "@/lib/store";
import { fetchChatsByUserId } from "@/lib/store/features/chat/chatSlice";
import { fetchUserByEmailOrPhone, updateUser } from "@/lib/store/features/user/userSlice";
import { useAppDispatch } from "@/lib/store/hooks";
import { useEffect } from "react";
import { useSelector } from "react-redux";

const CardSelectPlan = () => {
  const { nextStep } = useNavigationOnboarding();
  const userCurrent = useSelector((state: RootState) => state.user.user);
  const dispatch = useAppDispatch();

  useEffect(() => {
    (async () => {
      const data: any = await dispatch(fetchUserByEmailOrPhone());
      if (data.payload?.id) {
        dispatch(fetchChatsByUserId(data.payload?.id as string));
      }
    })();
  }, [dispatch]);

  const handlePlanSelection = async (plan: string) => {
    if (userCurrent?.id) {
      await dispatch(updateUser({ plan }));
      nextStep();
    }
  };

  return (
    <CardTemplate
      title="I will be using Espen AI as:"
      classes={{
        cardTitle: "text-center",
        card: "max-w-xl",
      }}
    >
      <CardTemplate.Content>
        <div className="flex flex-wrap justify-center gap-4">
          {[
            { title: "A Student", case: "student" },
            { title: "A Teacher", case: "teacher" },
          ].map((item) => (
            <button
              key={item.case}
              onClick={() => handlePlanSelection(item.case)}
              className="p-6 bg-white rounded-xl border border-[#e9e9e9] flex flex-col items-center gap-3 w-40 sm:w-48 lg:w-56 transition-all hover:bg-gray-100 hover:shadow-md"
            >
              <div className="relative w-16 h-16 flex items-center justify-center">
                {item.case === "student" ? (<svg width="61" height="60" viewBox="0 0 61 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M32.6376 56.1C33.1345 56.1 33.5376 56.5032 33.5376 57C33.5376 57.4969 33.1345 57.9 32.6376 57.9H19.1256C17.0889 57.9 15.235 57.0656 13.8946 55.7227C13.0743 54.9024 12.4415 53.8899 12.0758 52.7649H9.23753C8.09613 52.7649 7.05783 52.2961 6.30548 51.5461C5.55078 50.7891 5.08203 49.7508 5.08203 48.6094V44.7282C5.08203 42.7172 5.89533 40.8868 7.21013 39.5462L7.25935 39.4923C8.4289 38.3227 9.98515 37.5399 11.7171 37.3571V32.8009C11.7171 32.304 12.1203 31.9009 12.6171 31.9009C13.114 31.9009 13.5172 32.304 13.5172 32.8009V50.4889C13.5172 50.8826 13.5593 51.2693 13.6367 51.642L13.6507 51.7053C13.8875 52.7623 14.4242 53.7092 15.1648 54.4498C16.182 55.4647 17.5859 56.0975 19.1281 56.0975H32.6401L32.6376 56.1ZM47.3796 3.02004V17.821C48.5585 19.1335 49.278 20.8679 49.278 22.7616V37.3606C51.0101 37.5434 52.5686 38.3262 53.7358 39.4958L53.7851 39.5497C55.0999 40.8903 55.9132 42.7231 55.9132 44.7317V48.6129C55.9132 49.7543 55.4444 50.7926 54.6944 51.545C53.9374 52.2997 52.8991 52.7684 51.7577 52.7684H48.9171C48.5515 53.8934 47.921 54.9059 47.1007 55.7239C45.7578 57.0668 43.9038 57.9012 41.8647 57.9012H40.1514C39.6545 57.9012 39.2514 57.4981 39.2514 57.0012C39.2514 56.5044 39.6545 56.1012 40.1514 56.1012H41.8647C43.4069 56.1012 44.8085 55.4684 45.828 54.4512C46.571 53.7083 47.1077 52.7637 47.3444 51.709L47.3491 51.688V51.6856L47.3538 51.6669L47.3585 51.6458C47.4358 51.2731 47.478 50.8864 47.478 50.4927V27.0202C46.4561 27.9811 45.085 28.5717 43.5827 28.5717H40.8405V29.3545C40.8405 30.1842 40.5006 30.9389 39.9545 31.485C39.4084 32.0311 38.6537 32.3709 37.8241 32.3709C36.992 32.3709 36.2374 32.0311 35.6913 31.485C35.1452 30.9389 34.8053 30.1842 34.8053 29.3545V28.5717H26.1803V29.3545C26.1803 30.1842 25.8405 30.9389 25.2944 31.485C24.7483 32.0311 23.9936 32.3709 23.1639 32.3709C22.3319 32.3709 21.5772 32.0311 21.0311 31.485C20.485 30.9389 20.1452 30.1842 20.1452 29.3545V28.5717H17.403C15.903 28.5717 14.5295 27.9811 13.5077 27.0202V29.1319C13.5077 29.6287 13.1046 30.0319 12.6077 30.0319C12.1108 30.0319 11.7077 29.6287 11.7077 29.1319V22.7639C11.7077 20.8725 12.4272 19.1404 13.6061 17.8256V3.00156C13.6061 2.50469 14.0093 2.10156 14.5061 2.10156H21.6471C22.2846 2.10156 22.8799 2.28906 23.3792 2.62421C23.8761 2.95937 24.2721 3.44451 24.5089 4.03751L26.5433 9.10451L26.6464 9.04123C27.8324 8.32873 29.1613 7.97248 30.4902 7.97248C31.8167 7.97248 33.148 8.32873 34.3339 9.04123L34.437 9.10451L36.4714 4.03751C36.7105 3.44456 37.1066 2.95706 37.6035 2.62421C38.1004 2.28671 38.6957 2.10156 39.3332 2.10156H46.4742C46.9711 2.10156 47.3742 2.50469 47.3742 3.00156V3.02266L47.3796 3.02004ZM45.5796 16.354V7.64904L42.4765 15.374C43.5991 15.4678 44.6538 15.8126 45.5796 16.354ZM31.9321 15.3509L32.5204 13.8861C32.3282 13.6353 32.0891 13.4197 31.8149 13.2556C31.4118 13.0142 30.9548 12.8924 30.4954 12.8924C30.036 12.8924 29.579 13.0142 29.1758 13.2556C28.8993 13.422 28.6602 13.6377 28.468 13.8861L29.0563 15.3509H31.9321ZM40.5521 15.3509L45.1505 3.90194H39.338C39.0662 3.90194 38.8154 3.97928 38.6115 4.11522C38.4076 4.2535 38.2412 4.45506 38.1427 4.70582L35.8998 10.2933C36.3592 10.7761 36.7506 11.3175 37.0646 11.8988C37.6318 12.9464 37.9482 14.13 37.9646 15.3511L40.5521 15.3509ZM15.4111 7.65194V16.3569C16.3392 15.8155 17.3915 15.4686 18.5142 15.3772L15.4111 7.65194ZM25.0911 10.2957L22.8458 4.70819C22.745 4.45975 22.5809 4.25584 22.377 4.11759C22.1731 3.97933 21.9223 3.90431 21.6505 3.90431H15.838L20.4364 15.3533H23.0239C23.0403 14.1322 23.3591 12.9486 23.9239 11.901C24.238 11.3197 24.6294 10.7783 25.0888 10.2955L25.0911 10.2957ZM36.1701 15.3512C36.1537 14.4348 35.9123 13.5418 35.4834 12.7496C35.174 12.1777 34.7662 11.6574 34.2763 11.2168L34.2271 11.1747L34.2084 11.1559C33.9646 10.9426 33.6998 10.7504 33.4185 10.5817C32.5232 10.045 31.5107 9.77545 30.4959 9.77545C29.481 9.77545 28.4685 10.045 27.5732 10.5817C27.2873 10.7528 27.0178 10.9497 26.7693 11.1677L26.7646 11.1723H26.7623L26.7318 11.2005L26.7154 11.2169C26.2256 11.6575 25.8178 12.1778 25.5084 12.752C25.0795 13.5442 24.8381 14.4372 24.8217 15.3536H26.1436C26.16 14.6645 26.3381 13.9989 26.6522 13.4059C27.0225 12.7192 27.5686 12.1309 28.2553 11.7184C28.9467 11.3036 29.7225 11.095 30.4959 11.095C31.2693 11.095 32.0451 11.3036 32.7365 11.7184C33.4279 12.1333 33.9763 12.7215 34.3396 13.4059C34.6513 14.0012 34.8317 14.6669 34.8482 15.3536H36.1701L36.1701 15.3512ZM19.2176 43.2252H41.7741V42.3533C41.7741 41.7064 41.5092 41.1181 41.0827 40.6916C40.6561 40.265 40.0655 40.0002 39.4186 40.0002H21.5736C20.9267 40.0002 20.3385 40.265 19.9096 40.6916C19.483 41.1182 19.2182 41.7064 19.2182 42.3533L19.2176 43.2252ZM41.7741 45.0252H19.2176V48.3064C19.2176 48.9556 19.4824 49.5463 19.909 49.9705C20.3355 50.3971 20.9262 50.6619 21.573 50.6619H39.418C40.0672 50.6619 40.6579 50.397 41.0821 49.9705C41.5086 49.5439 41.7735 48.9533 41.7735 48.3064L41.7741 45.0252ZM21.5731 38.1977H39.4181C40.5618 38.1977 41.6025 38.6641 42.3548 39.4164C43.1071 40.1688 43.5735 41.207 43.5735 42.3508V48.3038C43.5735 49.4452 43.1048 50.4835 42.3548 51.2359C41.5977 51.9906 40.5595 52.4593 39.4181 52.4593H21.5731C20.4317 52.4593 19.3934 51.9906 18.641 51.2406C17.8863 50.4835 17.4176 49.4453 17.4176 48.3039V42.3509C17.4176 41.2071 17.8863 40.1665 18.6363 39.4165C19.3887 38.6641 20.4293 38.1977 21.5731 38.1977ZM37.8246 22.9677C38.6566 22.9677 39.4113 23.3075 39.9574 23.8536L40.0113 23.9122C40.5246 24.4536 40.841 25.1825 40.841 25.9841V26.7693H43.5832C44.6543 26.7693 45.6293 26.331 46.3347 25.6255C47.0285 24.9318 47.4644 23.9755 47.4785 22.9232V22.7615C47.4785 21.2193 46.8457 19.8177 45.8285 18.7982C44.8113 17.781 43.4074 17.1482 41.8652 17.1482H19.1242C17.5796 17.1482 16.1757 17.7786 15.1609 18.7935C14.1413 19.8107 13.5109 21.2146 13.5109 22.7591V22.9208C13.5249 23.9731 13.9609 24.927 14.6523 25.6208C15.3601 26.3286 16.3327 26.7669 17.4062 26.7669H20.1484V25.9817C20.1484 25.152 20.4882 24.3973 21.0343 23.8513C21.5804 23.3052 22.3351 22.9653 23.1671 22.9653C23.9991 22.9653 24.7538 23.3052 25.2999 23.8513L25.3538 23.9099C25.8671 24.4513 26.1835 25.1802 26.1835 25.9818V26.7669H34.8085V25.9818C34.8085 25.1521 35.1484 24.3974 35.6945 23.8513C36.2406 23.3053 36.9953 22.9654 37.8249 22.9654L37.8246 22.9677ZM37.8269 24.7677C37.4918 24.7677 37.1871 24.906 36.9668 25.1263C36.7465 25.3466 36.6082 25.6513 36.6082 25.9841V29.352C36.6082 29.6848 36.7465 29.9895 36.9668 30.2098C37.1871 30.4301 37.4918 30.5684 37.8246 30.5684C38.1597 30.5684 38.4621 30.4302 38.6824 30.2098C38.9027 29.9895 39.041 29.6848 39.041 29.352V25.9841C39.041 25.6677 38.9191 25.377 38.7199 25.1591L38.6847 25.1239C38.4644 24.9036 38.1597 24.7653 37.8269 24.7653L37.8269 24.7677ZM23.1689 24.7677C22.8338 24.7677 22.5291 24.906 22.3088 25.1263C22.0885 25.3466 21.9502 25.6513 21.9502 25.9841V29.352C21.9502 29.6848 22.0885 29.9895 22.3088 30.2098C22.5291 30.4301 22.8338 30.5684 23.1666 30.5684C23.5017 30.5684 23.8041 30.4302 24.0244 30.2098C24.2447 29.9895 24.383 29.6848 24.383 29.352V25.9841C24.383 25.6677 24.2611 25.377 24.0619 25.1591L24.0267 25.1239C23.8064 24.9036 23.5017 24.7653 23.1689 24.7653L23.1689 24.7677ZM49.2639 50.9687H51.7577C52.4069 50.9687 52.9975 50.7038 53.4217 50.2773C53.8483 49.8507 54.1131 49.2601 54.1131 48.6132V44.732C54.1131 43.2085 53.4991 41.8234 52.51 40.8109L52.4655 40.7687C51.6217 39.925 50.5131 39.3461 49.2803 39.1726V50.4906C49.2803 50.65 49.2757 50.8094 49.2663 50.9687L49.2639 50.9687ZM11.7284 50.9687C11.7167 50.8117 11.7144 50.6523 11.7144 50.4906V39.1726C10.4816 39.346 9.37296 39.9249 8.52921 40.7687L8.48468 40.8109C7.49328 41.821 6.88158 43.2085 6.88158 44.732V48.6132C6.88158 49.2624 7.14643 49.8531 7.57298 50.2773C7.99954 50.7038 8.59018 50.9687 9.23703 50.9687H11.7308L11.7284 50.9687ZM36.4784 56.1017C36.9753 56.1017 37.3784 56.5048 37.3784 57.0017C37.3784 57.4986 36.9753 57.9017 36.4784 57.9017H36.312C35.8151 57.9017 35.412 57.4986 35.412 57.0017C35.412 56.5048 35.8151 56.1017 36.312 56.1017H36.4784Z" fill="black" />
                </svg>) : (
                  <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M56.0569 25.5537C56.0569 25.0568 56.4601 24.6537 56.9569 24.6537C57.4538 24.6537 57.8569 25.0568 57.8569 25.5537V38.7607C57.8569 39.9654 57.3647 41.0622 56.5725 41.8521C55.9842 42.4404 55.2272 42.8646 54.3811 43.0427V50.5007C54.3811 51.7288 53.8796 52.8444 53.071 53.653C52.2624 54.4616 51.1468 54.9632 49.9186 54.9632H23.5371C23.0403 54.9632 22.6371 54.56 22.6371 54.0632C22.6371 53.5663 23.0403 53.1632 23.5371 53.1632H49.9186C50.6499 53.1632 51.3155 52.8632 51.7983 52.3804C52.2811 51.8976 52.5811 51.2319 52.5811 50.5007V43.1387H47.1551V46.7973C47.1551 47.2941 46.752 47.6973 46.2551 47.6973C45.7583 47.6973 45.3551 47.2941 45.3551 46.7973V43.1387H14.6541V46.7973C14.6541 47.2941 14.251 47.6973 13.7541 47.6973C13.2573 47.6973 12.8541 47.2941 12.8541 46.7973V43.1387H7.42814V50.5007C7.42814 51.2319 7.72814 51.8976 8.21094 52.3804C8.69374 52.8632 9.35939 53.1632 10.0906 53.1632H18.2066C18.7035 53.1632 19.1066 53.5663 19.1066 54.0632C19.1066 54.56 18.7035 54.9632 18.2066 54.9632H10.0906C8.86254 54.9632 7.74689 54.4593 6.93829 53.653C6.12969 52.8444 5.62814 51.7288 5.62814 50.5007V43.0427C4.78204 42.8645 4.02504 42.4403 3.43674 41.8521C2.64454 41.0599 2.15234 39.9654 2.15234 38.7607V16.1502C2.15234 14.9502 2.64453 13.8533 3.43904 13.0588C4.22889 12.2642 5.32344 11.7721 6.53044 11.7721H20.4734V8.28457C20.4734 7.39397 20.8391 6.58067 21.4273 5.99237L21.432 5.98768C22.0203 5.40173 22.8336 5.03613 23.7242 5.03613H36.2912C37.1818 5.03613 37.9951 5.40176 38.5834 5.99003L38.5881 5.99472C39.1741 6.58302 39.5397 7.39627 39.5397 8.28692V11.7744H53.4827C54.6874 11.7744 55.7842 12.2666 56.5741 13.0588C57.3663 13.851 57.8585 14.9455 57.8585 16.1502V20.2213C57.8585 20.7182 57.4553 21.1213 56.9585 21.1213C56.4616 21.1213 56.0585 20.7182 56.0585 20.2213V16.1502C56.0585 15.4424 55.7678 14.7979 55.3014 14.3315C54.835 13.8651 54.1905 13.5744 53.4827 13.5744H47.1547V41.3364H53.4827C54.1905 41.3364 54.835 41.0458 55.3014 40.5794C55.7678 40.1129 56.0585 39.4684 56.0585 38.7606V25.5536L56.0569 25.5537ZM45.3529 13.5747H14.6519V41.3367H45.3529V13.5747ZM12.8519 13.5747H6.52394C5.81614 13.5747 5.17159 13.8653 4.70519 14.3317C4.23644 14.7958 3.94814 15.4403 3.94814 16.1505V38.761C3.94814 39.4688 4.23877 40.1133 4.70519 40.5797C5.17162 41.0461 5.81849 41.3368 6.52394 41.3368H12.8519V13.5747ZM22.0674 18.6187H37.9344C39.1086 18.6187 40.1727 19.0991 40.9485 19.8726C41.7243 20.6484 42.2047 21.7148 42.2047 22.889C42.2047 24.0609 41.7243 25.1273 40.9508 25.903C40.175 26.6788 39.1086 27.1593 37.9344 27.1593H22.0674C20.8955 27.1593 19.8291 26.6788 19.0534 25.9054C18.2776 25.1296 17.7971 24.0608 17.7971 22.889C17.7971 21.7148 18.2776 20.6507 19.051 19.8749C19.8268 19.0991 20.8956 18.6187 22.0674 18.6187ZM37.9344 20.4187H22.0674C21.3877 20.4187 20.769 20.6952 20.3237 21.1429C19.8784 21.5882 19.5995 22.2093 19.5995 22.889C19.5995 23.5687 19.8761 24.1898 20.3237 24.6351C20.769 25.0804 21.3901 25.3593 22.0674 25.3593H37.9344C38.6141 25.3593 39.2329 25.0827 39.6805 24.6351C40.1259 24.1898 40.4047 23.5687 40.4047 22.8913C40.4047 22.2116 40.1282 21.5905 39.6805 21.1452C39.2352 20.6999 38.6141 20.421 37.9344 20.421V20.4187ZM22.2644 11.7752H37.7354V8.28767C37.7354 7.88923 37.5714 7.52362 37.3136 7.26347C37.0487 6.99863 36.6855 6.83691 36.2847 6.83691H23.7177C23.3192 6.83691 22.9536 7.00097 22.6935 7.25879C22.4286 7.52363 22.2669 7.88689 22.2669 8.28769V11.7752L22.2644 11.7752ZM20.6472 54.9612C20.1504 54.9612 19.7472 54.558 19.7472 54.0612C19.7472 53.5643 20.1504 53.1612 20.6472 53.1612H21.0855C21.5824 53.1612 21.9855 53.5643 21.9855 54.0612C21.9855 54.558 21.5824 54.9612 21.0855 54.9612H20.6472ZM56.0522 22.6692C56.0522 22.1723 56.4554 21.7692 56.9522 21.7692C57.4491 21.7692 57.8522 22.1723 57.8522 22.6692V23.1075C57.8522 23.6043 57.4491 24.0075 56.9522 24.0075C56.4554 24.0075 56.0522 23.6043 56.0522 23.1075V22.6692Z" fill="black" />
                  </svg>
                )}
              </div>
              <div className="text-black text-lg font-bold">{item.title}</div>
            </button>
          ))}
        </div>
      </CardTemplate.Content>
    </CardTemplate>
  );
};

export { CardSelectPlan };
